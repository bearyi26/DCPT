import numpy as np
from lib.test.evaluation.data import Sequence, BaseDataset, SequenceList
from lib.test.utils.load_text import load_text


class DarkTrack2021Dataset(BaseDataset):
    """ DarkTrack2021 dataset.
    """
    def __init__(self):
        super().__init__()
        self.base_path = self.env_settings.darktrack2021_path
        self.sequence_info_list = self._get_sequence_info_list()
    
    def get_sequence_list(self):
        return SequenceList([self._construct_sequence(s) for s in self.sequence_info_list])

    def _construct_sequence(self, sequence_info):
        sequence_path = sequence_info['path']
        nz = sequence_info['nz']
        ext = sequence_info['ext']
        start_frame = sequence_info['startFrame']
        end_frame = sequence_info['endFrame']

        init_omit = 0
        if 'initOmit' in sequence_info:
            init_omit = sequence_info['initOmit']

        frames = ['{base_path}/{sequence_path}/{frame:0{nz}}.{ext}'.format(base_path=self.base_path, 
        sequence_path=sequence_path, frame=frame_num, nz=nz, ext=ext) for frame_num in range(start_frame+init_omit, end_frame+1)]

        anno_path = '{}/{}'.format(self.base_path, sequence_info['anno_path'])

        ground_truth_rect = load_text(str(anno_path), delimiter=',', dtype=np.float64, backend='numpy')

        return Sequence(sequence_info['name'], frames, 'uav', ground_truth_rect[init_omit:,:],
                        object_class=sequence_info['object_class'])
    def _get_sequence_info_list(self):
        sequence_info_list = [
            {"name": "building_1", "path": "data_seq/building_1", "startFrame": 1, "endFrame": 551, "nz": 6,
             "ext": "jpg", "anno_path": "anno/building_1.txt", "object_class": "other"},
            {"name": "building_2", "path": "data_seq/building_2", "startFrame": 1, "endFrame": 6579, "nz": 6,
             "ext": "jpg", "anno_path": "anno/building_2.txt", "object_class": "other"},
            {"name": "bus_1", "path": "data_seq/bus_1", "startFrame": 1, "endFrame": 385, "nz": 6,
             "ext": "jpg", "anno_path": "anno/bus_1.txt", "object_class": "other"},
            {"name": "bus_2", "path": "data_seq/bus_2", "startFrame": 1, "endFrame": 2062, "nz": 6,
             "ext": "jpg", "anno_path": "anno/bus_2.txt", "object_class": "other"},
            {"name": "bus_3", "path": "data_seq/bus_3", "startFrame": 1, "endFrame": 2542, "nz": 6,
             "ext": "jpg", "anno_path": "anno/bus_3.txt", "object_class": "other"},
            {"name": "bus_4", "path": "data_seq/bus_4", "startFrame": 1, "endFrame": 301, "nz": 6,
             "ext": "jpg", "anno_path": "anno/bus_4.txt", "object_class": "other"},
            {"name": "bus_5", "path": "data_seq/bus_5", "startFrame": 1, "endFrame": 314, "nz": 6,
             "ext": "jpg", "anno_path": "anno/bus_5.txt", "object_class": "other"},
            {"name": "bus_6", "path": "data_seq/bus_6", "startFrame": 1, "endFrame": 3991, "nz": 6,
             "ext": "jpg", "anno_path": "anno/bus_6.txt", "object_class": "other"},
            {"name": "car_1", "path": "data_seq/car_1", "startFrame": 1, "endFrame": 183, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_1.txt", "object_class": "other"},
            {"name": "car_2", "path": "data_seq/car_2", "startFrame": 1, "endFrame": 1522, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_2.txt", "object_class": "other"},
            {"name": "car_3", "path": "data_seq/car_3", "startFrame": 1, "endFrame": 405, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_3.txt", "object_class": "other"},
            {"name": "car_4", "path": "data_seq/car_4", "startFrame": 1, "endFrame": 179, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_4.txt", "object_class": "other"},
            {"name": "car_5", "path": "data_seq/car_5", "startFrame": 1, "endFrame": 1866, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_5.txt", "object_class": "other"},
            {"name": "car_6", "path": "data_seq/car_6", "startFrame": 1, "endFrame": 761, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_6.txt", "object_class": "other"},
            {"name": "car_7", "path": "data_seq/car_7", "startFrame": 1, "endFrame": 92, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_7.txt", "object_class": "other"},
            {"name": "car_8", "path": "data_seq/car_8", "startFrame": 1, "endFrame": 430, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_8.txt", "object_class": "other"},
            {"name": "car_9", "path": "data_seq/car_9", "startFrame": 1, "endFrame": 673, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_9.txt", "object_class": "other"},
            {"name": "car_10", "path": "data_seq/car_10", "startFrame": 1, "endFrame": 195, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_10.txt", "object_class": "other"},
            {"name": "car_11", "path": "data_seq/car_11", "startFrame": 1, "endFrame": 416, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_11.txt", "object_class": "other"},
            {"name": "car_12", "path": "data_seq/car_12", "startFrame": 1, "endFrame": 316, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_12.txt", "object_class": "other"},
            {"name": "car_13", "path": "data_seq/car_13", "startFrame": 1, "endFrame": 723, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_13.txt", "object_class": "other"},
            {"name": "car_14", "path": "data_seq/car_14", "startFrame": 1, "endFrame": 351, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_14.txt", "object_class": "other"},
            {"name": "car_15", "path": "data_seq/car_15", "startFrame": 1, "endFrame": 406, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_15.txt", "object_class": "other"},
            {"name": "car_16", "path": "data_seq/car_16", "startFrame": 1, "endFrame": 1159, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_16.txt", "object_class": "other"},
            {"name": "car_17", "path": "data_seq/car_17", "startFrame": 1, "endFrame": 480, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_17.txt", "object_class": "other"},
            {"name": "car_18", "path": "data_seq/car_18", "startFrame": 1, "endFrame": 400, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_18.txt", "object_class": "other"},
            {"name": "car_19", "path": "data_seq/car_19", "startFrame": 1, "endFrame": 867, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_19.txt", "object_class": "other"},
            {"name": "car_20", "path": "data_seq/car_20", "startFrame": 1, "endFrame": 1390, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_20.txt", "object_class": "other"},
            {"name": "car_21", "path": "data_seq/car_21", "startFrame": 1, "endFrame": 1044, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_21.txt", "object_class": "other"},
            {"name": "car_22", "path": "data_seq/car_22", "startFrame": 1, "endFrame": 148, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_22.txt", "object_class": "other"},
            {"name": "car_23", "path": "data_seq/car_23", "startFrame": 1, "endFrame": 896, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_23.txt", "object_class": "other"},
            {"name": "car_24", "path": "data_seq/car_24", "startFrame": 1, "endFrame": 217, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_24.txt", "object_class": "other"},
            {"name": "car_25", "path": "data_seq/car_25", "startFrame": 1, "endFrame": 771, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_25.txt", "object_class": "other"},
            {"name": "car_26", "path": "data_seq/car_26", "startFrame": 1, "endFrame": 371, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_26.txt", "object_class": "other"},
            {"name": "car_27", "path": "data_seq/car_27", "startFrame": 1, "endFrame": 204, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_27.txt", "object_class": "other"},
            {"name": "car_28", "path": "data_seq/car_28", "startFrame": 1, "endFrame": 516, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_28.txt", "object_class": "other"},
            {"name": "car_29", "path": "data_seq/car_29", "startFrame": 1, "endFrame": 1215, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_29.txt", "object_class": "other"},
            {"name": "car_30", "path": "data_seq/car_30", "startFrame": 1, "endFrame": 289, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_30.txt", "object_class": "other"},
            {"name": "car_31", "path": "data_seq/car_31", "startFrame": 1, "endFrame": 141, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_31.txt", "object_class": "other"},
            {"name": "car_32", "path": "data_seq/car_32", "startFrame": 1, "endFrame": 192, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_32.txt", "object_class": "other"},
            {"name": "car_33", "path": "data_seq/car_33", "startFrame": 1, "endFrame": 678, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_33.txt", "object_class": "other"},
            {"name": "car_34", "path": "data_seq/car_34", "startFrame": 1, "endFrame": 1019, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_34.txt", "object_class": "other"},
            {"name": "car_35", "path": "data_seq/car_35", "startFrame": 1, "endFrame": 584, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_35.txt", "object_class": "other"},
            {"name": "car_36", "path": "data_seq/car_36", "startFrame": 1, "endFrame": 1679, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_36.txt", "object_class": "other"},
            {"name": "car_37", "path": "data_seq/car_37", "startFrame": 1, "endFrame": 200, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_37.txt", "object_class": "other"},
            {"name": "car_38", "path": "data_seq/car_38", "startFrame": 1, "endFrame": 306, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_38.txt", "object_class": "other"},
            {"name": "car_39", "path": "data_seq/car_39", "startFrame": 1, "endFrame": 668, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_39.txt", "object_class": "other"},
            {"name": "car_40", "path": "data_seq/car_40", "startFrame": 1, "endFrame": 520, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_40.txt", "object_class": "other"},
            {"name": "car_41", "path": "data_seq/car_41", "startFrame": 1, "endFrame": 451, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_41.txt", "object_class": "other"},
            {"name": "car_42", "path": "data_seq/car_42", "startFrame": 1, "endFrame": 316, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_42.txt", "object_class": "other"},
            {"name": "car_43", "path": "data_seq/car_43", "startFrame": 1, "endFrame": 460, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_43.txt", "object_class": "other"},
            {"name": "car_44", "path": "data_seq/car_44", "startFrame": 1, "endFrame": 3151, "nz": 6,
             "ext": "jpg", "anno_path": "anno/car_44.txt", "object_class": "other"},
            {"name": "dog_1", "path": "data_seq/dog_1", "startFrame": 1, "endFrame": 917, "nz": 6,
             "ext": "jpg", "anno_path": "anno/dog_1.txt", "object_class": "other"},
            {"name": "motor_1", "path": "data_seq/motor_1", "startFrame": 1, "endFrame": 201, "nz": 6,
             "ext": "jpg", "anno_path": "anno/motor_1.txt", "object_class": "other"},
            {"name": "motor_2", "path": "data_seq/motor_2", "startFrame": 1, "endFrame": 406, "nz": 6,
             "ext": "jpg", "anno_path": "anno/motor_2.txt", "object_class": "other"},
            {"name": "motor_3", "path": "data_seq/motor_3", "startFrame": 1, "endFrame": 622, "nz": 6,
             "ext": "jpg", "anno_path": "anno/motor_3.txt", "object_class": "other"},
            {"name": "motor_4", "path": "data_seq/motor_4", "startFrame": 1, "endFrame": 1216, "nz": 6,
             "ext": "jpg", "anno_path": "anno/motor_4.txt", "object_class": "other"},
            {"name": "motor_5", "path": "data_seq/motor_5", "startFrame": 1, "endFrame": 217, "nz": 6,
             "ext": "jpg", "anno_path": "anno/motor_5.txt", "object_class": "other"},
            {"name": "person_1", "path": "data_seq/person_1", "startFrame": 1, "endFrame": 114, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_1.txt", "object_class": "other"},
            {"name": "person_2", "path": "data_seq/person_2", "startFrame": 1, "endFrame": 420, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_2.txt", "object_class": "other"},
            {"name": "person_3", "path": "data_seq/person_3", "startFrame": 1, "endFrame": 961, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_3.txt", "object_class": "other"},
            {"name": "person_4", "path": "data_seq/person_4", "startFrame": 1, "endFrame": 730, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_4.txt", "object_class": "other"},
            {"name": "person_5", "path": "data_seq/person_5", "startFrame": 1, "endFrame": 555, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_5.txt", "object_class": "other"},
            {"name": "person_6", "path": "data_seq/person_6", "startFrame": 1, "endFrame": 833, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_6.txt", "object_class": "other"},
            {"name": "person_7", "path": "data_seq/person_7", "startFrame": 1, "endFrame": 1001, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_7.txt", "object_class": "other"},
            {"name": "person_8", "path": "data_seq/person_8", "startFrame": 1, "endFrame": 538, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_8.txt", "object_class": "other"},
            {"name": "person_9", "path": "data_seq/person_9", "startFrame": 1, "endFrame": 298, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_9.txt", "object_class": "other"},
            {"name": "person_10", "path": "data_seq/person_10", "startFrame": 1, "endFrame": 307, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_10.txt", "object_class": "other"},
            {"name": "person_11", "path": "data_seq/person_11", "startFrame": 1, "endFrame": 165, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_11.txt", "object_class": "other"},
            {"name": "person_12", "path": "data_seq/person_12", "startFrame": 1, "endFrame": 460, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_12.txt", "object_class": "other"},
            {"name": "person_13", "path": "data_seq/person_13", "startFrame": 1, "endFrame": 679, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_13.txt", "object_class": "other"},
            {"name": "person_14", "path": "data_seq/person_14", "startFrame": 1, "endFrame": 336, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_14.txt", "object_class": "other"},
            {"name": "person_15", "path": "data_seq/person_15", "startFrame": 1, "endFrame": 1204, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_15.txt", "object_class": "other"},
            {"name": "person_16", "path": "data_seq/person_16", "startFrame": 1, "endFrame": 733, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_16.txt", "object_class": "other"},
            {"name": "person_17", "path": "data_seq/person_17", "startFrame": 1, "endFrame": 800, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_17.txt", "object_class": "other"},
            {"name": "person_18", "path": "data_seq/person_18", "startFrame": 1, "endFrame": 1245, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_18.txt", "object_class": "other"},
            {"name": "person_19", "path": "data_seq/person_19", "startFrame": 1, "endFrame": 1300, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_19.txt", "object_class": "other"},
            {"name": "person_20", "path": "data_seq/person_20", "startFrame": 1, "endFrame": 2673, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_20.txt", "object_class": "other"},
            {"name": "person_21", "path": "data_seq/person_21", "startFrame": 1, "endFrame": 2500, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_21.txt", "object_class": "other"},
            {"name": "person_22", "path": "data_seq/person_22", "startFrame": 1, "endFrame": 892, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_22.txt", "object_class": "other"},
            {"name": "person_23", "path": "data_seq/person_23", "startFrame": 1, "endFrame": 1317, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_23.txt", "object_class": "other"},
            {"name": "person_24", "path": "data_seq/person_24", "startFrame": 1, "endFrame": 644, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_24.txt", "object_class": "other"},
            {"name": "person_25", "path": "data_seq/person_25", "startFrame": 1, "endFrame": 319, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_25.txt", "object_class": "other"},
            {"name": "person_26", "path": "data_seq/person_26", "startFrame": 1, "endFrame": 937, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_26.txt", "object_class": "other"},
            {"name": "person_27", "path": "data_seq/person_27", "startFrame": 1, "endFrame": 522, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_27.txt", "object_class": "other"},
            {"name": "person_28", "path": "data_seq/person_28", "startFrame": 1, "endFrame": 521, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_28.txt", "object_class": "other"},
            {"name": "person_29", "path": "data_seq/person_29", "startFrame": 1, "endFrame": 1781, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_29.txt", "object_class": "other"},
            {"name": "person_30", "path": "data_seq/person_30", "startFrame": 1, "endFrame": 551, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_30.txt", "object_class": "other"},
            {"name": "person_31", "path": "data_seq/person_31", "startFrame": 1, "endFrame": 2254, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_31.txt", "object_class": "other"},
            {"name": "person_32", "path": "data_seq/person_32", "startFrame": 1, "endFrame": 1934, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_32.txt", "object_class": "other"},
            {"name": "person_33", "path": "data_seq/person_33", "startFrame": 1, "endFrame": 1060, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_33.txt", "object_class": "other"},
            {"name": "person_34", "path": "data_seq/person_34", "startFrame": 1, "endFrame": 246, "nz": 6,
             "ext": "jpg", "anno_path": "anno/person_34.txt", "object_class": "other"},
            {"name": "skating_1", "path": "data_seq/skating_1", "startFrame": 1, "endFrame": 861, "nz": 6,
             "ext": "jpg", "anno_path": "anno/skating_1.txt", "object_class": "other"},
            {"name": "skating_2", "path": "data_seq/skating_2", "startFrame": 1, "endFrame": 2114, "nz": 6,
             "ext": "jpg", "anno_path": "anno/skating_2.txt", "object_class": "other"},
            {"name": "taxi_1", "path": "data_seq/taxi_1", "startFrame": 1, "endFrame": 863, "nz": 6,
             "ext": "jpg", "anno_path": "anno/taxi_1.txt", "object_class": "other"},
            {"name": "taxi_2", "path": "data_seq/taxi_2", "startFrame": 1, "endFrame": 479, "nz": 6,
             "ext": "jpg", "anno_path": "anno/taxi_2.txt", "object_class": "other"},
            {"name": "truck_1", "path": "data_seq/truck_1", "startFrame": 1, "endFrame": 585, "nz": 6,
             "ext": "jpg", "anno_path": "anno/truck_1.txt", "object_class": "other"},
            {"name": "truck_2", "path": "data_seq/truck_2", "startFrame": 1, "endFrame": 535, "nz": 6,
             "ext": "jpg", "anno_path": "anno/truck_2.txt", "object_class": "other"},
            {"name": "truck_3", "path": "data_seq/truck_3", "startFrame": 1, "endFrame": 238, "nz": 6,
             "ext": "jpg", "anno_path": "anno/truck_3.txt", "object_class": "other"},
            {"name": "truck_4", "path": "data_seq/truck_4", "startFrame": 1, "endFrame": 422, "nz": 6,
             "ext": "jpg", "anno_path": "anno/truck_4.txt", "object_class": "other"},
            {"name": "truck_5", "path": "data_seq/truck_5", "startFrame": 1, "endFrame": 1344, "nz": 6,
             "ext": "jpg", "anno_path": "anno/truck_5.txt", "object_class": "other"},
            {"name": "truck_6", "path": "data_seq/truck_6", "startFrame": 1, "endFrame": 1182, "nz": 6,
             "ext": "jpg", "anno_path": "anno/truck_6.txt", "object_class": "other"},
            {"name": "truck_7", "path": "data_seq/truck_7", "startFrame": 1, "endFrame": 172, "nz": 6,
             "ext": "jpg", "anno_path": "anno/truck_7.txt", "object_class": "other"},
            {"name": "truck_8", "path": "data_seq/truck_8", "startFrame": 1, "endFrame": 3171, "nz": 6,
             "ext": "jpg", "anno_path": "anno/truck_8.txt", "object_class": "other"},
            {"name": "truck_9", "path": "data_seq/truck_9", "startFrame": 1, "endFrame": 2221, "nz": 6,
             "ext": "jpg", "anno_path": "anno/truck_9.txt", "object_class": "other"},
            {"name": "truck_10", "path": "data_seq/truck_10", "startFrame": 1, "endFrame": 437, "nz": 6,
             "ext": "jpg", "anno_path": "anno/truck_10.txt", "object_class": "other"},
            {"name": "truck_11", "path": "data_seq/truck_11", "startFrame": 1, "endFrame": 1151, "nz": 6,
             "ext": "jpg", "anno_path": "anno/truck_11.txt", "object_class": "other"},
            {"name": "truck_12", "path": "data_seq/truck_12", "startFrame": 1, "endFrame": 2102, "nz": 6,
             "ext": "jpg", "anno_path": "anno/truck_12.txt", "object_class": "other"},
            {"name": "truck_13", "path": "data_seq/truck_13", "startFrame": 1, "endFrame": 1846, "nz": 6,
             "ext": "jpg", "anno_path": "anno/truck_13.txt", "object_class": "other"},
            {"name": "van_1", "path": "data_seq/van_1", "startFrame": 1, "endFrame": 670, "nz": 6,
             "ext": "jpg", "anno_path": "anno/van_1.txt", "object_class": "other"}
        ]

        return sequence_info_list